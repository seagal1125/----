### **Python 腳本開發需求說明**

**1. 專案目標**

開發一個 Python 腳本，用以回測一個針對 **VT (Vanguard Total World Stock ETF)** 的布林通道交易策略。目標是計算「耐心等待下一次布林下緣訊號出現才買入」相對於「在任意一天隨機買入」的策略勝率，並計算出平均需要等待的時間。

**2. 資料來源**

-   使用 `yfinance` Python 函式庫。
-   抓取 `VT` 這個 Ticker 從上市至今（`period='max'`）所有的每日歷史股價。
-   必須使用**還原調整後的收盤價** (`auto_adjust=True` 或使用 `Adj Close` 欄位) 進行所有計算，以確保股息和拆股都已納入考量。

**3. 核心分析邏輯**

腳本需要執行以下兩個主要分析：

**分析一：計算策略平均勝率**

此勝率旨在回答：「在任意一天，等待下一次布林下緣訊號出現才買，有多大的機率會比當天買入的成本更低？」

-   **步驟 1：計算布林通道**
    -   讀取 VT 的每日還原收盤價。
    -   計算**移動平均線 (SMA)**。
    -   計算**布林通道下緣** (Lower Band) = SMA - (標準差 * 標準差倍數)。

-   **步驟 2：識別獨立的買入訊號點**
    -   當日收盤價**小於或等於**布林通道下緣時，一個「買入訊號」被觸發。
    -   為避免在一次下跌中重複記錄訊號，需建立一個「冷卻」機制：當一個訊號被記錄後，必須等到價格**重新站上移動平均線(SMA)**之後，才能開始偵測下一個新的訊號點。
    -   將所有觸發的獨立訊號點（包含日期和價格）記錄在一個列表中。

-   **步驟 3：分段回測與計算勝率**
    -   分析的單位是**連續兩個訊號點之間的區間**。例如，分析「訊號點1」到「訊號點2」之間的時段。
    -   對於這樣一個區間（例如從 `T1` 到 `T2`），我們的目標價格是**區間末端**的訊號點價格，即 `T2` 的價格 `P2`。
    -   遍歷這個區間中的**每一天** (`d`)，取得其價格 `Pd`。
    -   如果 `Pd > P2`，則代表在 `d` 這天「等待」是正確的決定，計為一次「勝利」。
    -   計算此區間的勝率 = (區間內的勝利天數 / 區間內的總天數) * 100。
    -   對所有連續的訊號點區間重複此計算。

-   **步驟 4：計算總平均勝率**
    -   將所有區間的勝率取算術平均，得出最終的「總平均勝率」。

**分析二：計算平均等待天數**

此數據旨在回答：「從任意一天起算，平均需要等待多少天才能遇到下一個買入訊號？」

-   **步驟 1：** 使用與分析一相同的參數，找出所有獨立的「買入訊號點」的日期列表。
-   **步驟 2：** 遍歷整個歷史數據中的**每一個交易日**（從第一天到倒數第二個訊號點出現的那天）。
-   **步驟 3：** 對於每一個交易日，計算它與它**之後出現的第一個**訊號點之間相差的「日曆天數」。
-   **步驟 4：** 將所有計算出的「等待天數」取算術平均，得出「平均等待天數」。

**4. 可配置參數**

腳本應允許使用者輕易修改以下布林通道的核心參數：
-   `PERIOD` (期間): 計算移動平均線和標準差的天數 (例如: `15`)。
-   `STD_DEV_FACTOR` (標準差倍數): (例如: `1.5`)。

**5. 輸出格式**

腳本執行後，應在終端機印出清晰的總結報告，格式如下：

```
==================================================
VT 布林通道策略分析報告
==================================================
分析區間: [YYYY-MM-DD] 至 [YYYY-MM-DD]
使用參數: 期間=[PERIOD] 天, 標準差倍數=[STD_DEV_FACTOR]
--------------------------------------------------
平均勝率: [XX.XX]% (共 [N] 個分析區間)
平均等待天數: [YY.Y] 天
==================================================
```
